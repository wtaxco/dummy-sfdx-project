name: Deploy

on:
  push:
    branches:
      - main

  workflow_dispatch:
    inputs:
      run-tests:
        description: "Run Apex tests"
        type: boolean
        default: true
        required: true

jobs:
  deploy-dev:
    runs-on: ubuntu-latest
    environment: developer  # âœ… approvals allowed here
    steps:
      - name: Call reusable workflow
        uses: wtaxco/wtax-github-actions-workflows/.github/workflows/deploy-sfdx-project-to-developer.yml@main
        with:
          run-tests: ${{ inputs.run-tests }}
        secrets:
          ansible-vault-password: ${{ secrets.VAULT_PASSWORD }}

  deploy-uat:
    needs: deploy-dev
    runs-on: ubuntu-latest
    environment: uat
    steps:
      - name: Call reusable workflow
        uses: wtaxco/wtax-github-actions-workflows/.github/workflows/deploy-sfdx-project-to-uat.yml@main
        with:
          run-tests: true
        secrets:
          ansible-vault-password: ${{ secrets.VAULT_PASSWORD }}

  deploy-prod:
    needs: deploy-uat
    runs-on: ubuntu-latest
    environment: production
    steps:
      - name: Call reusable workflow
        uses: wtaxco/wtax-github-actions-workflows/.github/workflows/deploy-sfdx-project-to-prod.yml@main
        with:
          run-tests: true
        secrets:
          ansible-vault-password: ${{ secrets.VAULT_PASSWORD }}
